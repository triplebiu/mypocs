name: poc-yaml-minio-env-disclosure-cve-2023-28432
transport: http
set:
  reverse: newReverse()
  reverseURL: reverse.url
  reverseDomain: reverse.domain
rules:
  getVersion:
    request:
      cache: false
      method: GET
      path: ^/api/v1/check-version
      follow_redirects: false
      headers:
        User-Agent: >-
          Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36
          (KHTML, like Gecko) Chrome/112.0.0.0 Safari/537.36
        Accept: '*/*'
    expression: response.status == 200 && response.body_string.contains("minio/minio:")
    output:
      search:  '"\"minio/minio:RELEASE.(?P<releasedate>[\\d-]+)T(?P<releasetime>[\\d-]+)Z".bsubmatch(response.body)'
      releasedate: search["releasedate"]     # 如何判断 2019-12-17 <= releasedate < 2023-03-20
      releasetime: search["releasetime"]
# expression: getVersion() && releasedate >= "2019-12-17" && releasedate < "2023-03-20"     # 可能不准
expression: getVersion()
detail:
  author: tripleBiu
  links:
    - https://xz.aliyun.com/t/12356
  description: "当前RELEASE: {{releasedate}}T{{releasetime}}Z"
  product: minio
  # version: {{releasedate}}